<html>
<head>
  <title>Lediga dagar</title>
<!--
Gabriel Å 2003
-->
<style>
  h3 { font-family: Verdana, Arial, Helvetica; font-size: 16pt;  font-weight: bold}
  p  { font-family: Verdana, Arial, Helvetica; font-size: 14pt }
  body { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14pt; color: #000000; background-color: #ffffff; }
  table { color: #000000; border: 0px }
  td {  font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14pt }
  input { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14pt }
  select { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14pt }
</style>
<script>
function holidays(year) {
  var easter = easterSunday(year);
  var midsummer = midsummerDay(year);
  var allSaints = new Date(year, easter.getMonth(), easter.getDate() + 5*7 + 4);
  var holidayDates = [
    // general holidays (fixed)
    {date: new Date(year,  0,  1), name: "Nyårsdagen", generalHoliday: true},
    {date: new Date(year,  0,  6), name: "Trettondagen", generalHoliday: true},
    {date: new Date(year,  4,  1), name: "1:a maj", generalHoliday: true},
    {date: new Date(year, 11, 24), name: "Julafton", generalHoliday: true},
    {date: new Date(year, 11, 25), name: "Juldagen", generalHoliday: true},
    {date: new Date(year, 11, 26), name: "Annandag jul", generalHoliday: true},
    {date: new Date(year, 11, 31), name: "Nyårsafton", generalHoliday: true},

    // general holidays (dynamic)
    {date: easter, name: "Påskdagen", generalHoliday: true},
    {date: midsummer, name: "Midsommar", generalHoliday: true},
    {date: allaHelgonsDag(year), name: "Alla helgons dag", generalHoliday: true},

    // general derived holidays (dynamic)
    {date: new Date(year, easter.getMonth(), easter.getDate() - 2), name: "Långfredag", generalHoliday: true},
    {date: new Date(year, easter.getMonth(), easter.getDate() + 1), name: "Annandag påsk", generalHoliday: true},
    {date: allSaints, name: "Kristi himmelsfärd", generalHoliday: true},
    {date: new Date(year, easter.getMonth(), easter.getDate() + 7*7), name: "Pingstdagen", generalHoliday: true},

    // company specific holidays
    //{date: new Date(year, easter.getMonth(), easter.getDate() - 3), name: "Skärtorsdag", generalHoliday: false},
    //{date: new Date(year, midsummer.getMonth(), midsummer.getDate() - 2), name: "Day before midsummer eve", generalHoliday: false},
    //{date: new Date(year, allSaints.getMonth(), allSaints.getDate() - 1), name: "Day before All saints", generalHoliday: false},
    // {date: new Date(year, easter.getMonth(), easter.getDate() + 5*7 + 5), name: "Klämdag", generalHoliday: false},
    // {date: new Date(year, 11, 24), name: "Julledigt", generalHoliday: false},
    // {date: new Date(year, 11, 27), name: "Julledigt", generalHoliday: false},
    // {date: new Date(year, 11, 28), name: "Julledigt", generalHoliday: false},
    // {date: new Date(year, 11, 29), name: "Julledigt", generalHoliday: false},
    // {date: new Date(year, 11, 30), name: "Julledigt", generalHoliday: false},
    // Annandag pingst byts ut mot Sveriges nationaldag from 2005
    year < 2005 
    ? {date: new Date(year, easter.getMonth(), easter.getDate() + 7*7 + 1), name: "Annandag Pingst", generalHoliday: true}
    : {date: new Date(year, 5, 6), name: "Svenska flaggans dag", generalHoliday: true}
  ];
  holidayDates.sort(function(a, b) { return a.date - b.date;});
  return holidayDates;
}

function easterSunday(year) {
  // See http://aa.usno.navy.mil/faq/docs/easter.html
  var c = Math.floor(year/100);
  var n = year - 19 * Math.floor(year/19);
  var k = Math.floor((c - 17) / 25);
  var i = c - Math.floor(c / 4) - Math.floor(( c - k ) / 3) + 19 * n + 15;
  i = i - 30 * Math.floor(i / 30 );
  i = i - Math.floor(i/28) * (1 - Math.floor(i/28) * Math.floor(29/(i + 1)) * Math.floor((21 - n)/11));
  var j = year + Math.floor(year/4) + i + 2 - c + Math.floor(c/4);
  j = j - 7 * Math.floor(j/7);
  var l = i - j
  var month = Math.floor(3 + (l + 40)/44);
  var day = l + 28 - 31 * Math.floor(month/4);
  return new Date(year, month-1, day);
}

function midsummerDay(year) {
  // midsommardagen den lördag som infaller under tiden den 20--26 juni
  var guess = new Date(year, 5, 20);
  return new Date(guess.getFullYear(), guess.getMonth(), guess.getDate() + 6 - guess.getDay());
}

function allaHelgonsDag(year) {
  // alla helgons dag den lördag som infaller under tiden den 31 oktober--den 6 november
  var guess = new Date(year, 9, 31);
  return new Date(guess.getFullYear(), guess.getMonth(), guess.getDate() + 6 - guess.getDay());
}

function displayList() {
  var year = document.all.year.value-0;
  var showWeekends = document.all.showSunSat.checked;
  var hDays = holidays(year);
  var h = 0;
  var ih = "<table>";
  var tot = 0;
  for(i=0; i < hDays.length; ++i) {
    if(showWeekends || (hDays[i].date.getDay() != 0 && hDays[i].date.getDay() != 6)) {
      ih += '<tr><td>' + getDateString(hDays[i].date) + '</td><td><font color="' + (hDays[i].generalHoliday ? 'red' : 'blue') + '">' + hDays[i].name + '</font></td></tr>';
      ++tot;
    }
  }
  ih += '</table><br>';
  document.all.freeDays.innerHTML = ih + "Antal lediga dagar detta år: <b>" + tot + "</b>";
  var satSunDays = getSatSunDayCount(new Date(year, 0, 1), new Date(year, 11, 31));
  document.all.satSunDays.innerHTML = "Antal lördagar och söndagar detta år: <b>" + satSunDays + "</b>";
}

function getSatSunDayCount(startDate, endDate) {
  var curDay = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());
  var satSunDays = 0;
  while(curDay <= endDate) {
    if(curDay.getDay() == 0 || curDay.getDay() == 6) {
      satSunDays++;
    }

    curDay.setDate(curDay.getDate() + 1);
  }
  return satSunDays;
}

function getDateString(d) {
  const dayNames = ["söndag", "måndag", "tisdag", "onsdag", "torsdag", "fredag", "lördag"];
  return d.getFullYear() + "-" + addLeading0(d.getMonth()+1) + "-" + addLeading0(d.getDate()) + "</td><td>" + dayNames[d.getDay()];
  //return d.getDate() + "/" + (d.getMonth()+1) + "</td><td>" + dayNames[d.getDay()];
}

function addLeading0(num) {
  return (num < 10) ? "0" + (num+"") : (num+"");
}

function selectYear() {
  var currentYear = new Date().getFullYear();
  var startYear = currentYear - 4;
  var endYear = currentYear + 4;

  for(var i=startYear; i <= endYear; ++i) {
    var opt = document.createElement('option');
    opt.value = i;
    opt.text = i;
    opt.selected = i == currentYear;
    var sel = document.getElementById('year');

    try {
      sel.add(opt, null); // standards compliant; doesn't work in IE
    }
    catch(ex) {
      sel.add(opt); // IE only
    }
  }
}

function setup() {
  selectYear();
  displayList();
}
</script>
</head>
<body onload="setup();">
  <h3>Arbetsfria dagar</h3>
  <p>För år <select name="year" id="year" size="1" onchange="displayList();"></select> är dessa dagar helgdagar/klämdagar,<br>
  <input type="checkbox" id="showSunSat" checked onclick="displayList();" name="showSunSat">inkludera lördagar & söndagar:</p>
  <div id="freeDays"></div>
  <div id="satSunDays"></div>
</body>
</html>
